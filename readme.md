==========================================================
### Запуск программы

Программа запускается из класса Application.  

По умолчанию в системе создается пользователь admin с правами администратора и паролем 123.
Новые пользователи по умолчанию получают роль User, изменить роль пользователя на ADMIN может только действующий 
администратор системы. Пользователь по умолчанию создается силами репозитория пользователей.

==========================================================
### Конфигурация

Конфигурация репозиториев настраивается в файле application.yml, расположенном в каталоге resources.

==========================================================
### База данных

Для запуска базы данных в docker нужно запустить файл docker-compose.yml, находящийся в папке resources. 
Вместе с базой данных стартует контейнер с ПО для администрирования БД pgadmin.

Схема базы данных создается автоматически при запуске программы в режиме работы с БД. 
Таблицы создаются посредством миграций liquibase.

Файлы миграций находятся в каталоге resources/db/changelog, местоположение master changelog можно задать 
в файле application.yml. В настоящее время созданы два каталога. Initial содержит файлы создания последовательностей 
и таблиц в БД. 
В testdata находятся файлы миграций, вносящие в базу тестовые данные. 
Наборы тестовых данных подгружаются из csv-файлов (разделитель - ";" ), находящихся в test/testdata, и могут быть 
модифицированы. При модификации наборов данных следует обратить внимание на формат даты в данных транзакций - формат, 
выгружаемый по умолчанию MS Excel, не совместим с liquibase и требует модификации в соответствии с имеющимся шаблоном.
Загрузку тестовых данных можно отключить, исключив соответствующие миграции в master changelog.


==========================================================
### Эндпоинты и параметры запросов

Эндпоинты и параметры запросов можно посмотреть в swagger-ui по ссылке:
http://localhost:8089/ylab/swagger-ui/index.html

Документация OpenAPI размещается по ссылке:
http://localhost:8089/ylab/api-docs


#### Операции с регистрации и входа в систему:
POST{адрес сайта}/user/add - без дополнительных параметров, инициирует регистрацию нового пользователя. По умолчанию все пользователи 
получают роль USER. Данные пользователя передаются в теле запроса в следующем виде:
```
{
    "username": "IvanIvanovich",
    "email": "vanyatka@admin.com",
    "password": "MyPassword"
}
```
Имя пользователя должно быть уникальным, содержащим буквы и цифры не более 20 символов. Регистр не имеет значения.
Поле email должно быть валидным адресом электронной почты
Длина поля password не более 20 символов, регистр имеет значение. 


POST{адрес сайта}/auth/login - инициирует вход пользователя вы систему. Если пользователь заблокирован, 
ему будет отказано. Имя пользователя и пароль передаются в теле запроса в следующем виде:
```
{
"username": "admin",
"password": "123"
}
```
POST{адрес сайта}/auth/logout - без дополнительных параметров, отключает от системы текущего пользователя.

GET{адрес сайта}/auth/check - без дополнительных параметров, возвращает JSON с информацией о текущей сессии пользователя 

#### Операции с учетной записью пользователя:  

Операции с учетной записью доступны только после входа в систему под своей учетной записью.

PUT{адрес сайта}/user/change - предоставляет возможность редактирования профиля пользователя (имя, email, пароль). 
Формат данных запроса имеет следующий вид:
```
{
    "id": 5,
    "username": "superpuperadmin",
    "email": "superpuper@admin.com",
    "password": "MyPassword"
}
```

GET{адрес сайта}/user/get - без дополнительных параметров, возвращает данные учетной записи пользователя, за исключением пароля.


DELETE{адрес сайта}/user/delete - без дополнительных параметров, удаляет профиль пользователя и все его данные из системы.

#### Операции с транзакциями:
Операции с учетной записью доступны только после входа в систему под своей учетной записью.

POST{адрес сайта}/transaction/add - создание новой транзакции. Данные транзакции передаются в теле запроса в следующем виде:
```
{
    "type": "EXPENSE",
    "amount": 10000.0,
    "category": "swords",
    "date": "04-03-2025",
    "description": "new sword to the God of the Swords!"
}
```
поле type может содержать значения EXPENSE или INCOME. amount - число в формате double. category и 
description - символьные поля. date - дата в формате dd-MM-yyyy

PUT{адрес сайта}/transaction/add - изменение транзакции, введенной ранее. Возможность изменения суммы, категории 
и описания. Новые данные транзакции передаются в теле запроса в следующем виде:
```
{
    "id": 4,
    "amount": 10000.0,
    "category": "swords",
    "description": "new sword to the God of the Swords!"
}
```
id - идентификатор изменяемой транзакции. amount - число в формате double. category и
description - символьные поля.

DELETE{адрес сайта}/transaction/delete - удаление транзакции, введенной ранее. Вид тела запроса:
```
{
    "id": 5
}
```

GET{адрес сайта}/transaction/get - поиск транзакции по ее id. Вид тела запроса:
```
{
    "id": 4
}
```
GET{адрес сайта}/transaction/filtered Возвращение списка всех транзакций пользователя с возможностью фильтрации по дате, 
категории или типу (доход/расход). Формат тела запроса:
```
Для получения списка всех транзакций пользователя:
{
}

Для получения транзакций за конкретную дату:
{
    "date": "04-03-2025"
}

Для получения транзакций конкретного типа:
{
    "type": "INCOME"
}

Для получения транзакций конкретной категории:
{
    "category": "food"
}
Фильтры могут комбинироваться друг с другом в любом порядке.
Пример тела запроса с тремя филтрами:
{
    "type": "EXPENSE",
    "category": "food",
    "date": "04-03-2025"
}
```

#### Операции с бюджетом:
SET{адрес сайта}/budget/set - установка месячного бюджета. Формат тела запроса:
```
{
    "limit": 15.0
}
```

GET{адрес сайта}/budget/get - без дополнительных параметров, отслеживание превышения бюджета пользователя.


#### Операции с целями:
SET{адрес сайта}/target/set - установка цели (накопления). Формат тела запроса:
```
{
    "amount": 125.0
}
```
GET{адрес сайта}/target/get - без дополнительных параметров, отслеживание прогресса по цели.

#### Статистика и аналитика. 
Предоставляет следующие операции:
GET{адрес сайта}/stat/balance - без дополнительных параметров, подсчёт текущего баланса.

GET{адрес сайта}/stat/turnover - расчёт суммарного дохода и расхода за определённый период. Формат тела запроса:
```
{
    "startDate": "04-03-2025"
}
```
GET{адрес сайта}/stat/expenses - без дополнительных параметров, анализ расходов по категориям.

GET{адрес сайта}/stat/report - предоставляет сводный отчет. Формат ввода STAT REPORT.

#### API - уведомления. 
Предоставляет следующие операции:

GET{адрес сайта}/api/exceedance - без дополнительных параметров. API для напоминаний о достижении лимитов расходов. 
Возвращает true, если лимит бюджета данного пользователя был превышен.

GET{адрес сайта}/api/notifications - без дополнительных параметров. Возможность интеграции с email-уведомлениями. 
Предоставляет лист объектов, содержащих адрес e-mail и текст 
сообщения для уведомления о превышении бюджета.

#### Администрирование. 
Данные функции доступны только пользователям, имеющим роль ADMIN. 
Предоставляет следующие операции:

GET{адрес сайта}/adm/users - без дополнительных параметров. Возвращает список пользователей системы.

GET{адрес сайта}/adm/transactions - отображает список транзакций пользователя. Формат тела запроса:
```
{
    "id": 3
}
где id - номер пользователя
```
PUT{адрес сайта}/adm/block - блокировка пользователя. Запрещает вход без удаления пользовательских данных. 
Формат тела запроса:
```
{
    "id": 1
}
где id - номер пользователя
```
PUT{адрес сайта}/adm/unblock - разблокировка пользователя. Снимает блокировку с указанного пользователя. 
Формат тела запроса:
```
{
    "id": 1
}
где id - номер пользователя
```
DELETE{адрес сайта}/adm/delete - удаление пользователя. Полностью удаляет учетную запись и все пользовательские данные.
Формат тела запроса:
```
{
    "id": 6
}
```

PUT{адрес сайта}/adm/role - изменение роли пользователя. Формат тела запроса:
```
{
    "id": 1,
    "role": "ADMIN"
}
где id - номер пользователя, role - новая роль (ADMIN, USER)
```
Коллекция запросов Postman для проверки работы сервиса находится в папке doc проекта